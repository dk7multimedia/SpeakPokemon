<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pokémon Speech Therapy App</title>
    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for animations or specific overrides if needed */
        @keyframes fadeInMoveUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-fade-in-up {
            animation: fadeInMoveUp 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="font-sans">
    <div id="app" class="min-h-screen bg-gradient-to-br from-blue-100 to-indigo-200 flex flex-col items-center justify-center p-4 text-gray-800">
        <!-- Application UI will be rendered here by JavaScript -->
    </div>

    <script type="text/javascript">
        // Get the root element for the application
        const appDiv = document.getElementById('app');

        // Array of Pokémon data: name, their 3-digit number for Serebii.net URL
        // Expanded list of Pokémon (Generations 1-8) with added phonemeGroup for demonstration
        const pokemonList = [
            { name: 'Bulbasaur', number: '001', phonemeGroup: 'B/P Sounds' },
            { name: 'Ivysaur', number: '002' },
            { name: 'Venusaur', number: '003' },
            { name: 'Charmander', number: '004', phonemeGroup: 'Ch/J Sounds' },
            { name: 'Charmeleon', number: '005' },
            { name: 'Charizard', number: '006' },
            { name: 'Squirtle', number: '007', phonemeGroup: 'S/Z Sounds' },
            { name: 'Wartortle', number: '008' },
            { name: 'Blastoise', number: '009' },
            { name: 'Caterpie', number: '010' },
            { name: 'Metapod', number: '011' },
            { name: 'Butterfree', number: '012' },
            { name: 'Weedle', number: '013' },
            { name: 'Kakuna', number: '014' },
            { name: 'Beedrill', number: '015' },
            { name: 'Pidgey', number: '016' },
            { name: 'Pidgeotto', number: '017' },
            { name: 'Pidgeot', number: '018' },
            { name: 'Rattata', number: '019', phonemeGroup: 'R/L Sounds' },
            { name: 'Raticate', number: '020' },
            { name: 'Spearow', number: '021' },
            { name: 'Fearow', number: '022' },
            { name: 'Ekans', number: '023' },
            { name: 'Arbok', number: '024' },
            { name: 'Pikachu', number: '025', phonemeGroup: 'B/P Sounds' },
            { name: 'Raichu', number: '026' },
            { name: 'Sandshrew', number: '027' },
            { name: 'Sandslash', number: '028' },
            { name: 'Nidoran♀', number: '029' },
            { name: 'Nidorina', number: '030' },
            { name: 'Nidoqueen', number: '031' },
            { name: 'Nidoran♂', number: '032' },
            { name: 'Nidorino', number: '033' },
            { name: 'Nidoking', number: '034' },
            { name: 'Clefairy', number: '035' },
            { name: 'Clefable', number: '036' },
            { name: 'Vulpix', number: '037' },
            { name: 'Ninetales', number: '038' },
            { name: 'Jigglypuff', number: '039', phonemeGroup: 'Ch/J Sounds' },
            { name: 'Wigglytuff', number: '040' },
            { name: 'Zubat', number: '041', phonemeGroup: 'S/Z Sounds' },
            { name: 'Golbat', number: '042' },
            { name: 'Oddish', number: '043' },
            { name: 'Gloom', number: '044' },
            { name: 'Vileplume', number: '045' },
            { name: 'Paras', number: '046' },
            { name: 'Parasect', number: '047' },
            { name: 'Venonat', number: '048' },
            { name: 'Venomoth', number: '049' },
            { name: 'Diglett', number: '050' },
            { name: 'Dugtrio', number: '051' },
            { name: 'Meowth', number: '052' },
            { name: 'Persian', number: '053' },
            { name: 'Psyduck', number: '054', phonemeGroup: 'B/P Sounds' },
            { name: 'Golduck', number: '055' },
            { name: 'Mankey', number: '056' },
            { name: 'Primeape', number: '057' },
            { name: 'Growlithe', number: '058' },
            { name: 'Arcanine', number: '059' },
            { name: 'Poliwag', number: '060' },
            { name: 'Poliwhirl', number: '061' },
            { name: 'Poliwrath', number: '062' },
            { name: 'Abra', number: '063' },
            { name: 'Kadabra', number: '064' },
            { name: 'Alakazam', number: '065' },
            { name: 'Machop', number: '066' },
            { name: 'Machoke', number: '067' },
            { name: 'Machamp', number: '068' },
            { name: 'Bellsprout', number: '069', phonemeGroup: 'B/P Sounds' },
            { name: 'Weepinbell', number: '070' },
            { name: 'Victreebel', number: '071' },
            { name: 'Tentacool', number: '072' },
            { name: 'Tentacruel', number: '073' },
            { name: 'Geodude', number: '074' },
            { name: 'Graveler', number: '075' },
            { name: 'Golem', number: '076' },
            { name: 'Ponyta', number: '077' },
            { name: 'Rapidash', number: '078' },
            { name: 'Slowpoke', number: '079' },
            { name: 'Slowbro', number: '080' },
            { name: 'Magnemite', number: '081' },
            { name: 'Magneton', number: '082' },
            { name: 'Farfetch\'d', number: '083' },
            { name: 'Doduo', number: '084' },
            { name: 'Dodrio', number: '085' },
            { name: 'Seel', number: '086' },
            { name: 'Dewgong', number: '087' },
            { name: 'Grimer', number: '088' },
            { name: 'Muk', number: '089' },
            { name: 'Shellder', number: '090' },
            { name: 'Cloyster', number: '091' },
            { name: 'Gastly', number: '092' },
            { name: 'Haunter', number: '093' },
            { name: 'Gengar', number: '094' },
            { name: 'Onix', number: '095' },
            { name: 'Drowzee', number: '096' },
            { name: 'Hypno', number: '097' },
            { name: 'Krabby', number: '098' },
            { name: 'Kingler', number: '099' },
            { name: 'Voltorb', number: '100' },
            { name: 'Electrode', number: '101' },
            { name: 'Exeggcute', number: '102' },
            { name: 'Exeggutor', number: '103' },
            { name: 'Cubone', number: '104' },
            { name: 'Marowak', number: '105' },
            { name: 'Hitmonlee', number: '106' },
            { name: 'Hitmonchan', number: '107' },
            { name: 'Lickitung', number: '108' },
            { name: 'Koffing', number: '109' },
            { name: 'Weezing', number: '110' },
            { name: 'Rhyhorn', number: '111' },
            { name: 'Rhydon', number: '112' },
            { name: 'Chansey', number: '113' },
            { name: 'Tangela', number: '114' },
            { name: 'Kangaskhan', number: '115' },
            { name: 'Horsea', number: '116' },
            { name: 'Seadra', number: '117' },
            { name: 'Goldeen', number: '118' },
            { name: 'Seaking', number: '119' },
            { name: 'Staryu', number: '120' },
            { name: 'Starmie', number: '121' },
            { name: 'Mr. Mime', number: '122' },
            { name: 'Scyther', number: '123' },
            { name: 'Jynx', number: '124' },
            { name: 'Electabuzz', number: '125' },
            { name: 'Magmar', number: '126' },
            { name: 'Pinsir', number: '127' },
            { name: 'Tauros', number: '128' },
            { name: 'Magikarp', number: '129' },
            { name: 'Gyarados', number: '130' },
            { name: 'Lapras', number: '131', phonemeGroup: 'R/L Sounds' },
            { name: 'Ditto', number: '132' },
            { name: 'Eevee', number: '133' },
            { name: 'Vaporeon', number: '134' },
            { name: 'Jolteon', number: '135' },
            { name: 'Flareon', number: '136' },
            { name: 'Porygon', number: '137' },
            { name: 'Omanyte', number: '138' },
            { name: 'Omastar', number: '139' },
            { name: 'Kabuto', number: '140' },
            { name: 'Kabutops', number: '141' },
            { name: 'Aerodactyl', number: '142' },
            { name: 'Snorlax', number: '143', phonemeGroup: 'S/Z Sounds' },
            { name: 'Articuno', number: '144' },
            { name: 'Zapdos', number: '145' },
            { name: 'Moltres', number: '146' },
            { name: 'Dratini', number: '147' },
            { name: 'Dragonair', number: '148' },
            { name: 'Dragonite', number: '149' },
            { name: 'Mewtwo', number: '150' },
            { name: 'Mew', number: '151' },
            // Gen 2
            { name: 'Chikorita', number: '152', phonemeGroup: 'Ch/J Sounds' },
            { name: 'Bayleef', number: '153' }, { name: 'Meganium', number: '154' },
            { name: 'Cyndaquil', number: '155' }, { name: 'Quilava', number: '156' }, { name: 'Typhlosion', number: '157' },
            { name: 'Totodile', number: '158' }, { name: 'Croconaw', number: '159' }, { name: 'Feraligatr', number: '160' },
            { name: 'Sentret', number: '161' }, { name: 'Furret', number: '162' }, { name: 'Hoothoot', number: '163' },
            { name: 'Noctowl', number: '164' }, { name: 'Ledyba', number: '165' }, { name: 'Ledian', number: '166' },
            { name: 'Spinarak', number: '167' }, { name: 'Ariados', number: '168' }, { name: 'Crobat', number: '169' },
            { name: 'Chinchou', number: '170' }, { name: 'Lanturn', number: '171' }, { name: 'Pichu', number: '172' },
            { name: 'Cleffa', number: '173' }, { name: 'Igglybuff', number: '174' }, { name: 'Togepi', number: '175' },
            { name: 'Togetic', number: '176' }, { name: 'Natu', number: '177' }, { name: 'Xatu', number: '178' },
            { name: 'Mareep', number: '179' }, { name: 'Flaaffy', number: '180' }, { name: 'Ampharos', number: '181' },
            { name: 'Bellossom', number: '182' }, { name: 'Marill', number: '183' }, { name: 'Azumarill', number: '184' },
            { name: 'Sudowoodo', number: '185' }, { name: 'Politoed', number: '186' }, { name: 'Hoppip', number: '187' },
            { name: 'Skiploom', number: '188' }, { name: 'Jumpluff', number: '189' }, { name: 'Aipom', number: '190' },
            { name: 'Sunkern', number: '191' }, { name: 'Sunflora', number: '192' }, { name: 'Yanma', number: '193' },
            { name: 'Wooper', number: '194' }, { name: 'Quagsire', number: '195' }, { name: 'Murkrow', number: '196' },
            { name: 'Umbreon', number: '197' }, { name: 'Espeon', number: '198' }, { name: 'Slowking', number: '199' },
            { name: 'Misdreavus', number: '200' }, { name: 'Unown', number: '201' }, { name: 'Wobbuffet', number: '202' },
            { name: 'Girafarig', number: '203' }, { name: 'Pineco', number: '204' }, { name: 'Forretress', number: '205' },
            { name: 'Dunsparce', number: '206' }, { name: 'Gligar', number: '207' }, { name: 'Steelix', number: '208' },
            { name: 'Snubbull', number: '209' }, { name: 'Granbull', number: '210' }, { name: 'Qwilfish', number: '211' },
            { name: 'Scizor', number: '212' }, { name: 'Shuckle', number: '213' }, { name: 'Heracross', number: '214' },
            { name: 'Sneasel', number: '215' }, { name: 'Teddiursa', number: '216' }, { name: 'Ursaring', number: '217' },
            { name: 'Slugma', number: '218' }, { name: 'Magcargo', number: '219' }, { name: 'Swinub', number: '220' },
            { name: 'Piloswine', number: '221' }, { name: 'Corsola', number: '222' }, { name: 'Remoraid', number: '223' },
            { name: 'Octillery', number: '224' }, { name: 'Delibird', number: '225' }, { name: 'Mantine', number: '226' },
            { name: 'Skarmory', number: '227' }, { name: 'Houndour', number: '228' }, { name: 'Houndoom', number: '229' },
            { name: 'Kingdra', number: '230' }, { name: 'Phanpy', number: '231' }, { name: 'Donphan', number: '232' },
            { name: 'Porygon2', number: '233' }, { name: 'Stantler', number: '234' }, { name: 'Smeargle', number: '235' },
            { name: 'Tyrogue', number: '236' }, { name: 'Hitmontop', number: '237' }, { name: 'Smoochum', number: '238' },
            { name: 'Elekid', number: '239' }, { name: 'Magby', number: '240' }, { name: 'Miltank', number: '241' },
            { name: 'Blissey', number: '242' }, { name: 'Raikou', number: '243' }, { name: 'Entei', number: '244' },
            { name: 'Suicune', number: '245' }, { name: 'Larvitar', number: '246' }, { name: 'Pupitar', number: '247' },
            { name: 'Tyranitar', number: '248' }, { name: 'Lugia', number: '249' }, { name: 'Ho-Oh', number: '250' },
            { name: 'Celebi', number: '251' },
            // Gen 3
            { name: 'Treecko', number: '252' }, { name: 'Grovyle', number: '253' }, { name: 'Sceptile', number: '254' },
            { name: 'Torchic', number: '255' }, { name: 'Combusken', number: '256' }, { name: 'Blaziken', number: '257' },
            { name: 'Mudkip', number: '258' }, { name: 'Marshtomp', number: '259' }, { name: 'Swampert', number: '260' },
            { name: 'Poochyena', number: '261' }, { name: 'Mightyena', number: '262' }, { name: 'Zigzagoon', number: '263', phonemeGroup: 'S/Z Sounds' },
            { name: 'Linoone', number: '264' }, { name: 'Wurmple', number: '265' }, { name: 'Silcoon', number: '266' },
            { name: 'Beautifly', number: '267' }, { name: 'Cascoon', number: '268' }, { name: 'Dustox', number: '269' },
            { name: 'Lotad', number: '270' }, { name: 'Lombre', number: '271' }, { name: 'Ludicolo', number: '272' },
            { name: 'Seedot', number: '273' }, { name: 'Nuzleaf', number: '274' }, { name: 'Shiftry', number: '275' },
            { name: 'Taillow', number: '276' }, { name: 'Swellow', number: '277' }, { name: 'Wingull', number: '278' },
            { name: 'Pelipper', number: '279' }, { name: 'Ralts', number: '280' }, { name: 'Kirlia', number: '281' },
            { name: 'Gardevoir', number: '282' }, { name: 'Surskit', number: '283' }, { name: 'Masquerain', number: '284' },
            { name: 'Shroomish', number: '285' }, { name: 'Breloom', number: '286' }, { name: 'Slakoth', number: '287' },
            { name: 'Vigoroth', number: '288' }, { name: 'Slaking', number: '289' }, { name: 'Nincada', number: '290' },
            { name: 'Ninjask', number: '291' }, { name: 'Shedinja', number: '292' }, { name: 'Whismur', number: '293' },
            { name: 'Loudred', number: '294' }, { name: 'Exploud', number: '295' }, { name: 'Makuhita', number: '296' },
            { name: 'Hariyama', number: '297' }, { name: 'Azurill', number: '298' }, { name: 'Nosepass', number: '299' },
            { name: 'Skitty', number: '300' }, { name: 'Delcatty', number: '301' }, { name: 'Sableye', number: '302' },
            { name: 'Mawile', number: '303' }, { name: 'Aron', number: '304' }, { name: 'Lairon', number: '305' },
            { name: 'Aggron', number: '306' }, { name: 'Meditite', number: '307' }, { name: 'Medicham', number: '308' },
            { name: 'Electrike', number: '309' }, { name: 'Manectric', number: '310' }, { name: 'Plusle', number: '311' },
            { name: 'Minun', number: '312' }, { name: 'Volbeat', number: '313' }, { name: 'Illumise', number: '314' },
            { name: 'Roselia', number: '315' }, { name: 'Gulpin', number: '316' }, { name: 'Swalot', number: '317' },
            { name: 'Carvanha', number: '318' }, { name: 'Sharpedo', number: '319' }, { name: 'Wailmer', number: '320' },
            { name: 'Wailord', number: '321' }, { name: 'Numel', number: '322' }, { name: 'Camerupt', number: '323' },
            { name: 'Torkoal', number: '324' }, { name: 'Spoink', number: '325' }, { name: 'Grumpig', number: '326' },
            { name: 'Spinda', number: '327' }, { name: 'Trapinch', number: '328' }, { name: 'Vibrava', number: '329' },
            { name: 'Flygon', number: '330' }, { name: 'Cacnea', number: '331' }, { name: 'Cacturne', number: '332' },
            { name: 'Swablu', number: '333' }, { name: 'Altaria', number: '334' }, { name: 'Zangoose', number: '335', phonemeGroup: 'S/Z Sounds' },
            { name: 'Seviper', number: '336' }, { name: 'Lunatone', number: '337' }, { name: 'Solrock', number: '338' },
            { name: 'Barboach', number: '339' }, { name: 'Whiscash', number: '340' }, { name: 'Corphish', number: '341' },
            { name: 'Crawdaunt', number: '342' }, { name: 'Baltoy', number: '343' }, { name: 'Claydol', number: '344' },
            { name: 'Lileep', number: '345' }, { name: 'Cradily', number: '346' }, { name: 'Anorith', number: '347' },
            { name: 'Armaldo', number: '348' }, { name: 'Feebas', number: '349' }, { name: 'Milotic', number: '350' },
            { name: 'Castform', number: '351' }, { name: 'Kecleon', number: '352' }, { name: 'Shuppet', number: '353' },
            { name: 'Banette', number: '354' }, { name: 'Duskull', number: '355' }, { name: 'Dusclops', number: '356' },
            { name: 'Tropius', number: '357' }, { name: 'Chimecho', number: '358' }, { name: 'Absol', number: '359' },
            { name: 'Wynaut', number: '360' }, { name: 'Snorunt', number: '361' }, { name: 'Glalie', number: '362' },
            { name: 'Spheal', number: '363' }, { name: 'Sealeo', number: '364' }, { name: 'Walrein', number: '365' },
            { name: 'Clamperl', number: '366' }, { name: 'Huntail', number: '367' }, { name: 'Gorebyss', number: '368' },
            { name: 'Relicanth', number: '369' }, { name: 'Luvdisc', number: '370' }, { name: 'Bagon', number: '371' },
            { name: 'Shelgon', number: '372' }, { name: 'Salamence', number: '373' }, { name: 'Beldum', number: '374' },
            { name: 'Metang', number: '375' }, { name: 'Metagross', number: '376' }, { name: 'Regirock', number: '377' },
            { name: 'Regice', number: '378' }, { name: 'Registeel', number: '379' }, { name: 'Latias', number: '380' },
            { name: 'Latios', number: '381' }, { name: 'Kyogre', number: '382' }, { name: 'Groudon', number: '383' },
            { name: 'Rayquaza', number: '384' }, { name: 'Jirachi', number: '385' }, { name: 'Deoxys', number: '386' },
            // Gen 4
            { name: 'Turtwig', number: '387' }, { name: 'Grotle', number: '388' }, { name: 'Torterra', number: '389' },
            { name: 'Chimchar', number: '390' }, { name: 'Monferno', number: '391' }, { name: 'Infernape', number: '392' },
            { name: 'Piplup', number: '393' }, { name: 'Prinplup', number: '394' }, { name: 'Empoleon', number: '395' },
            { name: 'Starly', number: '396' }, { name: 'Staravia', number: '397' }, { name: 'Staraptor', number: '398' },
            { name: 'Bidoof', number: '399' }, { name: 'Bibarel', number: '400' }, { name: 'Kricketot', number: '401' },
            { name: 'Kricketune', number: '402' }, { name: 'Shinx', number: '403' }, { name: 'Luxio', number: '404' },
            { name: 'Luxray', number: '405' }, { name: 'Budew', number: '406' }, { name: 'Roserade', number: '407' },
            { name: 'Cranidos', number: '408' }, { name: 'Rampardos', number: '409' }, { name: 'Shieldon', number: '410' },
            { name: 'Bastiodon', number: '411' }, { name: 'Burmy', number: '412' }, { name: 'Wormadam', number: '413' },
            { name: 'Mothim', number: '414' }, { name: 'Combee', number: '415' }, { name: 'Vespiquen', number: '416' },
            { name: 'Pachirisu', number: '417' }, { name: 'Buizel', number: '418' }, { name: 'Floatzel', number: '419' },
            { name: 'Cherubi', number: '420' }, { name: 'Cherrim', number: '421' }, { name: 'Shellos', number: '422' },
            { name: 'Gastrodon', number: '423' }, { name: 'Ambipom', number: '424' }, { name: 'Drifloon', number: '425' },
            { name: 'Drifblim', number: '426' }, { name: 'Buneary', number: '427' }, { name: 'Lopunny', number: '428' },
            { name: 'Mismagius', number: '429' }, { name: 'Honchkrow', number: '430' }, { name: 'Glameow', number: '431' },
            { name: 'Purugly', number: '432' }, { name: 'Chingling', number: '433' }, { name: 'Stunky', number: '434' },
            { name: 'Skuntank', number: '435' }, { name: 'Bronzor', number: '436' }, { name: 'Bronzong', number: '437' },
            { name: 'Bonsly', number: '438' }, { name: 'Mime Jr.', number: '439' }, { name: 'Happiny', number: '440' },
            { name: 'Chatot', number: '441' }, { name: 'Spiritomb', number: '442' }, { name: 'Gible', number: '443' },
            { name: 'Gabite', number: '444' }, { name: 'Garchomp', number: '445' }, { name: 'Munchlax', number: '446' },
            { name: 'Riolu', number: '447' }, { name: 'Lucario', number: '448' }, { name: 'Hippopotas', number: '449' },
            { name: 'Hippowdon', number: '450' }, { name: 'Skorupi', number: '451' }, { name: 'Drapion', number: '452' },
            { name: 'Croagunk', number: '453' }, { name: 'Toxicroak', number: '454' }, { name: 'Carnivine', number: '455' },
            { name: 'Finneon', number: '456' }, { name: 'Lumineon', number: '457' }, { name: 'Mantyke', number: '458' },
            { name: 'Snover', number: '459' }, { name: 'Abomasnow', number: '460' }, { name: 'Weavile', number: '461' },
            { name: 'Magnezone', number: '462' }, { name: 'Lickilicky', number: '463' }, { name: 'Rhyperior', number: '464' },
            { name: 'Tangrowth', number: '465' }, { name: 'Electivire', number: '466' }, { name: 'Magmortar', number: '467' },
            { name: 'Togekiss', number: '468' }, { name: 'Yanmega', number: '469' }, { name: 'Leafeon', number: '470' },
            { name: 'Glaceon', number: '471' }, { name: 'Gliscor', number: '472' }, { name: 'Mamoswine', number: '473' },
            { name: 'Porygon-Z', number: '474' }, { name: 'Gallade', number: '475' }, { name: 'Probopass', number: '476' },
            { name: 'Dusknoir', number: '477' }, { name: 'Froslass', number: '478' }, { name: 'Rotom', number: '479' },
            { name: 'Uxie', number: '480' }, { name: 'Mesprit', number: '481' }, { name: 'Azelf', number: '482' },
            { name: 'Dialga', number: '483' }, { name: 'Palkia', number: '484' }, { name: 'Heatran', number: '485' },
            { name: 'Regigigas', number: '486' }, { name: 'Giratina', number: '487' }, { name: 'Cresselia', number: '488' },
            { name: 'Phione', number: '489' }, { name: 'Manaphy', number: '490' }, { name: 'Darkrai', number: '491' },
            { name: 'Shaymin', number: '492' }, { name: 'Arceus', number: '493' },
            // Gen 5
            { name: 'Victini', number: '494' }, { name: 'Snivy', number: '495' }, { name: 'Servine', number: '496' }, { name: 'Serperior', number: '497' },
            { name: 'Tepig', number: '498' }, { name: 'Pignite', number: '499' }, { name: 'Emboar', number: '500' },
            { name: 'Oshawott', number: '501' }, { name: 'Dewott', number: '502' }, { name: 'Samurott', number: '503' },
            { name: 'Patrat', number: '504' }, { name: 'Watchog', number: '505' }, { name: 'Lillipup', number: '506' }, { name: 'Herdier', number: '507' },
            { name: 'Stoutland', number: '508' }, { name: 'Purrloin', number: '509' }, { name: 'Liepard', number: '510' },
            { name: 'Pansage', number: '511' }, { name: 'Simisage', number: '512' }, { name: 'Pansear', number: '513' }, { name: 'Simisear', number: '514' },
            { name: 'Panpour', number: '515' }, { name: 'Simipour', number: '516' }, { name: 'Munna', number: '517' }, { name: 'Musharna', number: '518' },
            { name: 'Pidove', number: '519' }, { name: 'Tranquill', number: '520' }, { name: 'Unfezant', number: '521' },
            { name: 'Blitzle', number: '522' }, { name: 'Zebstrika', number: '523' }, { name: 'Roggenrola', number: '524' },
            { name: 'Boldore', number: '525' }, { name: 'Gigalith', number: '526' }, { name: 'Woobat', number: '527' }, { name: 'Swoobat', number: '528' },
            { name: 'Drilbur', number: '529' }, { name: 'Excadrill', number: '530' }, { name: 'Audino', number: '531' }, { name: 'Timburr', number: '532' },
            { name: 'Gurdurr', number: '533' }, { name: 'Conkeldurr', number: '534' }, { name: 'Tympole', number: '535' }, { name: 'Palpitoad', number: '536' },
            { name: 'Seismitoad', number: '537' }, { name: 'Throh', number: '538' }, { name: 'Sawk', number: '539' }, { name: 'Sewaddle', number: '540' },
            { name: 'Swadloon', number: '541' }, { name: 'Leavanny', number: '542' }, { name: 'Venipede', number: '543' }, { name: 'Whirlipede', number: '544' },
            { name: 'Scolipede', number: '545' }, { name: 'Cottonee', number: '546' }, { name: 'Whimsicott', number: '547' },
            { name: 'Petilil', number: '548' }, { name: 'Lilligant', number: '549' }, { name: 'Basculin', number: '550' },
            { name: 'Sandile', number: '551' }, { name: 'Krokorok', number: '552' }, { name: 'Krookodile', number: '553' },
            { name: 'Darumaka', number: '554' }, { name: 'Darmanitan', number: '555' }, { name: 'Maractus', number: '556' },
            { name: 'Dwebble', number: '557' }, { name: 'Crustle', number: '558' }, { name: 'Scraggy', number: '559' }, { name: 'Scrafty', number: '560' },
            { name: 'Sigilyph', number: '561' }, { name: 'Yamask', number: '562' }, { name: 'Cofagrigus', number: '563' },
            { name: 'Tirtouga', number: '564' }, { name: 'Carracosta', number: '565' }, { name: 'Archen', number: '566' }, { name: 'Archeops', number: '567' },
            { name: 'Trubbish', number: '568' }, { name: 'Garbodor', number: '569' }, { name: 'Zorua', number: '570' }, { name: 'Zoroark', number: '571' },
            { name: 'Minccino', number: '572' }, { name: 'Cinccino', number: '573' }, { name: 'Gothita', number: '574' }, { name: 'Gothorita', number: '575' },
            { name: 'Gothitelle', number: '576' }, { name: 'Solosis', number: '577' }, { name: 'Duosion', number: '578' }, { name: 'Reuniclus', number: '579' },
            { name: 'Ducklett', number: '580' }, { name: 'Swanna', number: '581' }, { name: 'Vanillite', number: '582' }, { name: 'Vanillish', number: '583' },
            { name: 'Vanilluxe', number: '584' }, { name: 'Deerling', number: '585' }, { name: 'Sawsbuck', number: '586' },
            { name: 'Emolga', number: '587' }, { name: 'Karrablast', number: '588' }, { name: 'Escavalier', number: '589' },
            { name: 'Foongus', number: '590' }, { name: 'Amoonguss', number: '591' }, { name: 'Frillish', number: '592' }, { name: 'Jellicent', number: '593' },
            { name: 'Alomomola', number: '594' }, { name: 'Joltik', number: '595' }, { name: 'Galvantula', number: '596' },
            { name: 'Ferroseed', number: '597' }, { name: 'Ferrothorn', number: '598' }, { name: 'Klink', number: '599' },
            { name: 'Klang', number: '600' }, { name: 'Klinklang', number: '601' }, { name: 'Tynamo', number: '602' },
            { name: 'Eelektrik', number: '603' }, { name: 'Eelektross', number: '604' }, { name: 'Elgyem', number: '605' }, { name: 'Beheeyem', number: '606' },
            { name: 'Litwick', number: '607' }, { name: 'Lampent', number: '608' }, { name: 'Chandelure', number: '609' },
            { name: 'Axew', number: '610' }, { name: 'Fraxure', number: '611' }, { name: 'Haxorus', number: '612' },
            { name: 'Cubchoo', number: '613' }, { name: 'Beartic', number: '614' }, { name: 'Cryogonal', number: '615' },
            { name: 'Shelmet', number: '616' }, { name: 'Accelgor', number: '617' }, { name: 'Stunfisk', number: '618' },
            { name: 'Mienfoo', number: '619' }, { name: 'Mienshao', number: '620' }, { name: 'Druddigon', number: '621' },
            { name: 'Golett', number: '622' }, { name: 'Golurk', number: '623' }, { name: 'Pawniard', number: '624' }, { name: 'Bisharp', number: '625' },
            { name: 'Bouffalant', number: '626' }, { name: 'Rufflet', number: '627' }, { name: 'Braviary', number: '628' },
            { name: 'Vullaby', number: '629' }, { name: 'Mandibuzz', number: '630' }, { name: 'Heatmor', number: '631' }, { name: 'Durant', number: '632' },
            { name: 'Deino', number: '633' }, { name: 'Zweilous', number: '634' }, { name: 'Hydreigon', number: '635' },
            { name: 'Larvesta', number: '636' }, { name: 'Volcarona', number: '637' }, { name: 'Cobalion', number: '638' },
            { name: 'Terrakion', number: '639' }, { name: 'Virizion', number: '640' }, { name: 'Tornadus', number: '641' },
            { name: 'Thundurus', number: '642' }, { name: 'Reshiram', number: '643' }, { name: 'Zekrom', number: '644' },
            { name: 'Landorus', number: '645' }, { name: 'Kyurem', number: '646' }, { name: 'Keldeo', number: '647' },
            { name: 'Meloetta', number: '648' }, { name: 'Genesect', number: '649' },
            // Gen 6
            { name: 'Chespin', number: '650' }, { name: 'Quilladin', number: '651' }, { name: 'Chesnaught', number: '652' },
            { name: 'Fennekin', number: '653' }, { name: 'Braixen', number: '654' }, { name: 'Delphox', number: '655' },
            { name: 'Froakie', number: '656' }, { name: 'Frogadier', number: '657' }, { name: 'Greninja', number: '658' },
            { name: 'Bunnelby', number: '659' }, { name: 'Diggersby', number: '660' }, { name: 'Fletchling', number: '661' },
            { name: 'Fletchinder', number: '662' }, { name: 'Talonflame', number: '663' }, { name: 'Scatterbug', number: '664' },
            { name: 'Spewpa', number: '665' }, { name: 'Vivillon', number: '666' }, { name: 'Litleo', number: '667' }, { name: 'Pyroar', number: '668' },
            { name: 'Flabébé', number: '669' }, { name: 'Floette', number: '670' }, { name: 'Florges', number: '671' },
            { name: 'Skiddo', number: '672' }, { name: 'Gogoat', number: '673' }, { name: 'Pancham', number: '674' }, { name: 'Pangoro', number: '675' },
            { name: 'Furfrou', number: '676' }, { name: 'Espurr', number: '677' }, { name: 'Meowstic', number: '678' },
            { name: 'Honedge', number: '679' }, { name: 'Doublade', number: '680' }, { name: 'Aegislash', number: '681' },
            { name: 'Spritzee', number: '682' }, { name: 'Aromatisse', number: '683' }, { name: 'Swirlix', number: '684' }, { name: 'Slurpuff', number: '685' },
            { name: 'Inkay', number: '686' }, { name: 'Malamar', number: '687' }, { name: 'Binacle', number: '688' }, { name: 'Barbaracle', number: '689' },
            { name: 'Skrelp', number: '690' }, { name: 'Dragalge', number: '691' }, { name: 'Clauncher', number: '692' }, { name: 'Clawitzer', number: '693' },
            { name: 'Helioptile', number: '694' }, { name: 'Heliolisk', number: '695' }, { name: 'Tyrunt', number: '696' }, { name: 'Tyrantrum', number: '697' },
            { name: 'Amaura', number: '698' }, { name: 'Aurorus', number: '699' }, { name: 'Sylveon', number: '700' }, { name: 'Hawlucha', number: '701' },
            { name: 'Dedenne', number: '702' }, { name: 'Carbink', number: '703' }, { name: 'Goomy', number: '704' }, { name: 'Sliggoo', number: '705' },
            { name: 'Goodra', number: '706' }, { name: 'Klefki', number: '707' }, { name: 'Phantump', number: '708' }, { name: 'Trevenant', number: '709' },
            { name: 'Pumpkaboo', number: '710' }, { name: 'Gourgeist', number: '711' }, { name: 'Bergmite', number: '712' }, { name: 'Avalugg', number: '713' },
            { name: 'Noibat', number: '714' }, { name: 'Noivern', number: '715' }, { name: 'Xerneas', number: '716' }, { name: 'Yveltal', number: '717' },
            { name: 'Zygarde', number: '718' }, { name: 'Diancie', number: '719' }, { name: 'Hoopa', number: '720' }, { name: 'Volcanion', number: '721' },
            // Gen 7
            { name: 'Rowlet', number: '722', phonemeGroup: 'R/L Sounds' },
            { name: 'Dartrix', number: '723' }, { name: 'Decidueye', number: '724' },
            { name: 'Litten', number: '725' }, { name: 'Torracat', number: '726' }, { name: 'Incineroar', number: '727' },
            { name: 'Popplio', number: '728' }, { name: 'Brionne', number: '729' }, { name: 'Primarina', number: '730' },
            { name: 'Pikipek', number: '731' }, { name: 'Trumbeak', number: '732' }, { name: 'Toucannon', number: '733' },
            { name: 'Yungoos', number: '734' }, { name: 'Gumshoos', number: '735' }, { name: 'Grubbin', number: '736' },
            { name: 'Charjabug', number: '737' }, { name: 'Vikavolt', number: '738' }, { name: 'Crabrawler', number: '739' },
            { name: 'Crabominable', number: '740' }, { name: 'Oricorio', number: '741' }, { name: 'Cutiefly', number: '742' }, { name: 'Ribombee', number: '743' },
            { name: 'Rockruff', number: '744' }, { name: 'Lycanroc', number: '745' }, { name: 'Wishiwashi', number: '746' },
            { name: 'Mareanie', number: '747' }, { name: 'Toxapex', number: '748' }, { name: 'Mudbray', number: '749' }, { name: 'Mudsdale', number: '750' },
            { name: 'Dewpider', number: '751' }, { name: 'Araquanid', number: '752' }, { name: 'Fomantis', number: '753' }, { name: 'Lurantis', number: '754' },
            { name: 'Morelull', number: '755' }, { name: 'Shiinotic', number: '756' }, { name: 'Salandit', number: '757' }, { name: 'Salazzle', number: '758' },
            { name: 'Stufful', number: '759' }, { name: 'Bewear', number: '760' }, { name: 'Bounsweet', number: '761' }, { name: 'Steenee', number: '762' },
            { name: 'Tsareena', number: '763' }, { name: 'Comfey', number: '764' }, { name: 'Oranguru', number: '765' }, { name: 'Passimian', number: '766' },
            { name: 'Wimpod', number: '767' }, { name: 'Golisopod', number: '768' }, { name: 'Sandygast', number: '769' }, { name: 'Palossand', number: '770' },
            { name: 'Pyukumuku', number: '771' }, { name: 'Type: Null', number: '772' }, { name: 'Silvally', number: '773' },
            { name: 'Minior', number: '774' }, { name: 'Komala', number: '775' }, { name: 'Turtonator', number: '776' }, { name: 'Togedemaru', number: '777' },
            { name: 'Mimikyu', number: '778' }, { name: 'Bruxish', number: '779' }, { name: 'Drampa', number: '780' }, { name: 'Dhelmise', number: '781' },
            { name: 'Jangmo-o', number: '782' }, { name: 'Hakamo-o', number: '783' }, { name: 'Kommo-o', number: '784' },
            { name: 'Tapu Koko', number: '785' }, { name: 'Tapu Lele', number: '786' }, { name: 'Tapu Bulu', number: '787' }, { name: 'Tapu Fini', number: '788' },
            { name: 'Cosmog', number: '789' }, { name: 'Cosmoem', number: '790' }, { name: 'Solgaleo', number: '791' }, { name: 'Lunala', number: '792' },
            { name: 'Nihilego', number: '793' }, { name: 'Buzzwole', number: '794' }, { name: 'Pheromosa', number: '795' }, { name: 'Xurkitree', number: '796' },
            { name: 'Celesteela', number: '797' }, { name: 'Kartana', number: '798' }, { name: 'Guzzlord', number: '799' },
            { name: 'Necrozma', number: '800' }, { name: 'Magearna', number: '801' }, { name: 'Marshadow', number: '802' },
            { name: 'Poipole', number: '803' }, { name: 'Naganadel', number: '804' }, { name: 'Stakataka', number: '805' }, { name: 'Blacephalon', number: '806' },
            { name: 'Zeraora', number: '807' }, { name: 'Meltan', number: '808' }, { name: 'Melmetal', number: '809' },
            // Gen 8
            { name: 'Grookey', number: '810' }, { name: 'Thwackey', number: '811' }, { name: 'Rillaboom', number: '812' },
            { name: 'Scorbunny', number: '813' }, { name: 'Raboot', number: '814' }, { name: 'Cinderace', number: '815' },
            { name: 'Sobble', number: '816' }, { name: 'Drizzile', number: '817' }, { name: 'Inteleon', number: '818' },
            { name: 'Skwovet', number: '819' }, { name: 'Greedent', number: '820' }, { name: 'Rookidee', number: '821' },
            { name: 'Corvisquire', number: '822' }, { name: 'Corviknight', number: '823' }, { name: 'Blipbug', number: '824' },
            { name: 'Dottler', number: '825' }, { name: 'Orbeetle', number: '826' }, { name: 'Nickit', number: '827' }, { name: 'Thievul', number: '828' },
            { name: 'Gossifleur', number: '829' }, { name: 'Eldegoss', number: '830' }, { name: 'Wooloo', number: '831' }, { name: 'Dubwool', number: '832' },
            { name: 'Chewtle', number: '833' }, { name: 'Drednaw', number: '834' }, { name: 'Yamper', number: '835' }, { name: 'Boltund', number: '836' },
            { name: 'Rolycoly', number: '837' }, { name: 'Carkol', number: '838' }, { name: 'Coalossal', number: '839' },
            { name: 'Applin', number: '840' }, { name: 'Flapple', number: '841' }, { name: 'Appletun', number: '842' },
            { name: 'Silicobra', number: '843' }, { name: 'Sandaconda', number: '844' }, { name: 'Cramorant', number: '845' }, { name: 'Arrokuda', number: '846' },
            { name: 'Barraskewda', number: '847' }, { name: 'Toxel', number: '848' }, { name: 'Toxtricity', number: '849' },
            { name: 'Sizzlipede', number: '850' }, { name: 'Centiskorch', number: '851' }, { name: 'Clobbopus', number: '852' }, { name: 'Grapploct', number: '853' },
            { name: 'Sinistea', number: '854' }, { name: 'Polteageist', number: '855' }, { name: 'Hatenna', number: '856' }, { name: 'Hattrem', number: '857' },
            { name: 'Hatterene', number: '858' }, { name: 'Impidimp', number: '859' }, { name: 'Morgrem', number: '860' }, { name: 'Grimmsnarl', number: '861' },
            { name: 'Obstagoon', number: '862' }, { name: 'Perrserker', number: '863' }, { name: 'Cursola', number: '864' }, { name: 'Sirfetch\'d', number: '865' },
            { name: 'Mr. Rime', number: '866' }, { name: 'Runerigus', number: '867' }, { name: 'Milcery', number: '868' }, { name: 'Alcremie', number: '869' },
            { name: 'Falinks', number: '870' }, { name: 'Pincurchin', number: '871' }, { name: 'Snom', number: '872' }, { name: 'Frosmoth', number: '873' },
            { name: 'Stonjourner', number: '874' }, { name: 'Eiscue', number: '875' }, { name: 'Indeedee', number: '876' }, { name: 'Morpeko', number: '877' },
            { name: 'Cufant', number: '878' }, { name: 'Copperajah', number: '879' }, { name: 'Dracozolt', number: '880' }, { name: 'Arctozolt', number: '881' },
            { name: 'Dracovish', number: '882' }, { name: 'Arctovish', number: '883' }, { name: 'Duraludon', number: '884' }, { name: 'Dreepy', number: '885' },
            { name: 'Drakloak', number: '886' }, { name: 'Dragapult', number: '887' }, { name: 'Zacian', number: '888' }, { name: 'Zamazenta', number: '889' },
            { name: 'Eternatus', number: '890' }, { name: 'Kubfu', number: '891' }, { name: 'Urshifu', number: '892' },
            { name: 'Zarude', number: '893' }, { name: 'Regieleki', number: '894' }, { name: 'Regidrago', number: '895' },
            { name: 'Glastrier', number: '896' }, { name: 'Spectrier', number: '897' }, { name: 'Calyrex', number: '898' },
            { name: 'Wyrdeer', number: '899' }, { name: 'Kleavor', number: '900' }, { name: 'Ursaluna', number: '901' },
            { name: 'Basculegion', number: '902' }, { name: 'Sneasler', number: '903' }, { name: 'Overqwil', number: '904' },
            { name: 'Enamorus', number: '905' }
        ];

        // Global state variables
        let currentPokemon = null;
        let feedbackMessage = '';
        let listening = false;
        let showName = false;
        let score = 0;
        let answeredCorrectly = false;
        let currentPokemonPhonetic = '';
        let selectedPhonemeFilter = 'All'; // New state for selected filter

        // Media recording variables
        let mediaRecorder = null;
        let audioChunks = [];
        let audioBlobUrl = '';
        let isRecording = false;

        // Speech Recognition object
        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        let recognition = null;

        // Initialize speech recognition if available
        if (SpeechRecognition) {
            recognition = new SpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'en-US';

            recognition.onresult = (event) => {
                // Stop recording when speech recognition provides a result
                if (isRecording && mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
                const transcript = event.results[0][0].transcript.toLowerCase().trim();
                checkAnswer(transcript);
                listening = false;
                renderApp(); // Re-render after recognition ends
            };

            recognition.onerror = (event) => {
                console.error('Speech recognition error:', event.error);
                if (isRecording && mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop(); // Stop recording on error too
                }
                if (event.error === 'not-allowed') {
                    feedbackMessage = 'Microphone access denied. Please allow microphone access in your browser settings.';
                } else if (event.error === 'no-speech') {
                    feedbackMessage = 'No speech detected.';
                } else {
                    feedbackMessage = `Error: ${event.error}. Try again!`;
                }
                listening = false;
                renderApp();
            };

            recognition.onend = () => {
                listening = false;
                // If recording is still active after recognition ends (e.g., short speech), stop it
                if (isRecording && mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
                renderApp();
            };
        } else {
            feedbackMessage = 'Speech recognition not supported in this browser.';
            console.warn('SpeechRecognition API not supported.');
        }

        // Function to get phonetic pronunciation from LLM (for 'Reveal Name')
        const getPhoneticPronunciation = async (name) => {
            try {
                const prompt = `Provide a simple, easy-to-understand phonetic pronunciation of "${name}" in English for a child learning speech. Only provide the phonetic text, no extra words or phrases. For example, for 'Pikachu', respond with 'Pee-kah-choo'. For 'Bulbasaur', respond with 'Bul-buh-sor'.`;
                const chatHistory = [{ role: "user", parts: [{ text: prompt }] }];
                const payload = { contents: chatHistory };
                const apiKey = ""; // Canvas will automatically provide this
                const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.0-flash:generateContent?key=${apiKey}`;

                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(payload)
                });

                const result = await response.json();
                if (result.candidates && result.candidates.length > 0 &&
                    result.candidates[0].content && result.candidates[0].content.parts &&
                    result.candidates[0].content.parts.length > 0) {
                    return result.candidates[0].content.parts[0].text.trim();
                } else {
                    console.warn("LLM response for pronunciation was unexpected or empty. Returning original name.");
                    return name;
                }
            } catch (error) {
                console.error("Error fetching pronunciation from LLM:", error);
                return name;
            }
        };

        // Function to select and display the next random Pokémon based on filter
        const nextPokemon = () => {
            feedbackMessage = '';
            showName = false;
            answeredCorrectly = false;
            currentPokemonPhonetic = '';
            // Clear previous recording
            if (audioBlobUrl) {
                URL.revokeObjectURL(audioBlobUrl);
                audioBlobUrl = '';
            }
            isRecording = false; // Ensure recording state is reset

            let filteredList = pokemonList;
            if (selectedPhonemeFilter !== 'All') {
                filteredList = pokemonList.filter(p => p.phonemeGroup === selectedPhonemeFilter);
            }

            if (filteredList.length === 0) {
                feedbackMessage = 'No Pokémon found for the selected filter.';
                currentPokemon = null; // Clear current Pokémon if no matches
            } else {
                const randomIndex = Math.floor(Math.random() * filteredList.length);
                currentPokemon = filteredList[randomIndex];
            }

            renderApp();
        };

        // Function to handle phoneme filter change
        const handlePhonemeFilterChange = (event) => {
            selectedPhonemeFilter = event.target.value;
            nextPokemon(); // Load a new Pokémon with the new filter
        };

        // Function to open YouTube pronunciation link
        const openPronunciationLink = () => {
            if (!currentPokemon) return;
            const pokemonName = currentPokemon.name;
            const youtubeSearchUrl = `https://www.youtube.com/@howtopronouncepokemon/search?query=${encodeURIComponent(pokemonName)}`;
            window.open(youtubeSearchUrl, '_blank');
        };

        // Function to start or stop recording and speech recognition
        const toggleRecordingAndListening = async () => {
            if (isRecording) {
                // Stop recording and recognition
                if (mediaRecorder && mediaRecorder.state === 'recording') {
                    mediaRecorder.stop();
                }
                if (recognition && listening) {
                    recognition.stop();
                }
                isRecording = false;
                listening = false; // Ensure listening state is false
                feedbackMessage = ''; // Clear feedback
                renderApp();
            } else {
                // Start recording and recognition
                if (!recognition) {
                    feedbackMessage = 'Speech recognition not available.';
                    renderApp();
                    return;
                }

                // Clear previous recording before starting new one
                if (audioBlobUrl) {
                    URL.revokeObjectURL(audioBlobUrl);
                    audioBlobUrl = '';
                }
                audioChunks = []; // Clear chunks for new recording

                try {
                    const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                    mediaRecorder = new MediaRecorder(stream, { mimeType: 'audio/webm; codecs=opus' });

                    mediaRecorder.ondataavailable = event => {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = () => {
                        const audioBlob = new Blob(audioChunks, { type: 'audio/webm; codecs=opus' });
                        audioBlobUrl = URL.createObjectURL(audioBlob);
                        audioChunks = []; // Clear for next recording
                        isRecording = false; // Recording officially stopped
                        renderApp(); // Update UI to show playback button
                    };

                    mediaRecorder.onerror = (event) => {
                        console.error('MediaRecorder error:', event.error);
                        feedbackMessage = `Recording error: ${event.error.name}.`;
                        isRecording = false;
                        listening = false;
                        renderApp();
                    };

                    mediaRecorder.start();
                    recognition.start();

                    isRecording = true;
                    listening = true;
                    feedbackMessage = ''; // Clear previous messages
                    renderApp(); // Update UI to show "Listening..." state
                } catch (err) {
                    console.error('Microphone access denied:', err);
                    feedbackMessage = 'Microphone access denied. Please allow microphone access in your browser settings.';
                    isRecording = false;
                    listening = false;
                    renderApp();
                }
            }
        };

        // Function to play the recorded audio
        const playRecording = () => {
            if (audioBlobUrl) {
                const audio = new Audio(audioBlobUrl);
                audio.play();
                feedbackMessage = 'Playing your recording...';
                renderApp();
                audio.onended = () => {
                    feedbackMessage = '';
                    renderApp();
                };
                audio.onerror = (e) => {
                    console.error('Audio playback error:', e);
                    feedbackMessage = 'Failed to play recording.';
                    renderApp();
                };
            }
        };

        // Function to check the recognized speech against the current Pokémon's name
        const checkAnswer = (transcript) => {
            if (!currentPokemon) return;

            const pokemonName = currentPokemon.name.toLowerCase().trim();
            const spokenName = transcript.toLowerCase().trim();

            if (spokenName === pokemonName) {
                score++;
                showName = true;
                answeredCorrectly = true;
                getPhoneticPronunciation(currentPokemon.name).then(phonetic => {
                    currentPokemonPhonetic = phonetic;
                    renderApp();
                });
            } else {
                // No specific feedback message for incorrect answer
            }
            renderApp();
        };

        // Handle image load error, display a placeholder
        const handleImageError = (event) => {
            event.target.src = "https://placehold.co/200x200/cccccc/333333?text=Image+Error";
            feedbackMessage = "Couldn't load Pokémon image. Try again.";
            renderApp();
        };

        // Function to render the entire application UI
        const renderApp = () => {
            // Collect unique phoneme groups for the filter dropdown
            const phonemeGroups = Array.from(new Set(pokemonList.map(p => p.phonemeGroup).filter(Boolean))).sort();
            phonemeGroups.unshift('All'); // Add 'All' option first

            appDiv.innerHTML = `
                <div class="bg-white rounded-3xl shadow-2xl p-6 md:p-8 flex flex-col items-center max-w-lg w-full text-center border-4 border-indigo-300 transform transition-all duration-300 hover:scale-105">
                    <h1 class="text-4xl md:text-5xl font-extrabold text-indigo-700 mb-6 drop-shadow-md">
                        Pokémon Talk!
                    </h1>

                    <!-- Score display -->
                    <div class="text-2xl font-bold mb-4 text-green-700">
                        Score: ${score}
                    </div>

                    <!-- Phoneme Filter Dropdown -->
                    <div class="mb-6 w-full max-w-xs">
                        <label for="phoneme-filter" class="block text-xl font-semibold text-gray-700 mb-2">Filter by Phoneme Group:</label>
                        <select
                            id="phoneme-filter"
                            class="block w-full px-4 py-2 rounded-lg border-2 border-indigo-300 bg-white text-lg focus:outline-none focus:ring-2 focus:ring-indigo-500"
                        >
                            ${phonemeGroups.map(group => `
                                <option value="${group}" ${selectedPhonemeFilter === group ? 'selected' : ''}>
                                    ${group}
                                </option>
                            `).join('')}
                        </select>
                    </div>

                    <!-- Pokémon Card -->
                    ${currentPokemon ? `
                        <div class="bg-purple-100 rounded-2xl p-5 mb-6 border-2 border-purple-300 shadow-lg w-full max-w-xs flex flex-col items-center">
                            <img
                                id="pokemon-image"
                                src="https://www.serebii.net/pokemongo/pokemon/${currentPokemon.number}.png"
                                alt="${currentPokemon.name}"
                                class="w-48 h-48 md:w-56 md:h-56 object-contain mb-4 filter drop-shadow-lg"
                            />
                            ${showName ? `
                                <p class="text-3xl md:text-4xl font-bold text-purple-800 animate-fade-in-up">
                                    ${currentPokemon.name}
                                </p>
                                ${currentPokemonPhonetic ? `
                                    <p class="text-xl md:text-2xl font-semibold text-gray-600 mt-2">
                                        (${currentPokemonPhonetic})
                                    </p>
                                ` : ''}
                            ` : ''}
                        </div>
                    ` : `
                        <div class="bg-purple-100 rounded-2xl p-5 mb-6 border-2 border-purple-300 shadow-lg w-full max-w-xs flex flex-col items-center justify-center h-56">
                            <p class="text-xl font-semibold text-gray-600">Select a filter and click Next Pokémon</p>
                        </div>
                    `}

                    <!-- Action Buttons -->
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 w-full">
                        <!-- Open Pronunciation Button -->
                        <button
                            id="open-pronunciation-button"
                            class="
                                w-full py-3 px-6 rounded-xl text-white font-bold text-lg shadow-md transition duration-300 ease-in-out
                                bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 hover:shadow-lg active:scale-95
                            "
                            ${answeredCorrectly || isRecording || !currentPokemon ? 'disabled' : ''}
                        >
                            Open Pronunciation
                        </button>

                        <!-- Say Name Button (toggles recording/listening) -->
                        <button
                            id="say-name-button"
                            class="
                                w-full py-3 px-6 rounded-xl text-white font-bold text-lg shadow-md transition duration-300 ease-in-out
                                ${answeredCorrectly || !recognition || !currentPokemon ? 'bg-gradient-to-r from-gray-400 to-gray-500 cursor-not-allowed' : (isRecording ? 'bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 active:scale-95' : 'bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 hover:shadow-lg active:scale-95')}
                            "
                            ${answeredCorrectly || !recognition || !currentPokemon ? 'disabled' : ''}
                        >
                            ${isRecording ? 'Stop Recording' : 'Say Name'}
                        </button>

                        <!-- Play Recording Button -->
                        ${audioBlobUrl ? `
                            <button
                                id="play-recording-button"
                                class="
                                    w-full py-3 px-6 rounded-xl text-white font-bold text-lg shadow-md transition duration-300 ease-in-out
                                    bg-gradient-to-r from-purple-500 to-purple-600 hover:from-purple-600 hover:to-purple-700 hover:shadow-lg active:scale-95
                                "
                                ${isRecording || !currentPokemon ? 'disabled' : ''}
                            >
                                Play Recording
                            </button>
                        ` : `
                            <button
                                class="
                                    w-full py-3 px-6 rounded-xl text-white font-bold text-lg shadow-md transition duration-300 ease-in-out
                                    bg-gradient-to-r from-gray-300 to-gray-400 cursor-not-allowed
                                "
                                disabled
                            >
                                Play Recording
                            </button>
                        `}

                        <!-- Reveal Name Button -->
                        <button
                            id="reveal-name-button"
                            class="
                                w-full py-3 px-6 rounded-xl text-white font-bold text-lg shadow-md transition duration-300 ease-in-out
                                ${showName || answeredCorrectly || isRecording || !currentPokemon ? 'bg-gradient-to-r from-pink-300 to-pink-400 cursor-not-allowed' : 'bg-gradient-to-r from-pink-500 to-pink-600 hover:from-pink-600 hover:to-pink-700 hover:shadow-lg active:scale-95'}
                            "
                            ${showName || answeredCorrectly || isRecording || !currentPokemon ? 'disabled' : ''}
                        >
                            Reveal Name
                        </button>

                        <!-- Next Pokémon Button -->
                        <button
                            id="next-pokemon-button"
                            class="col-span-full w-full py-3 px-6 rounded-xl bg-gradient-to-r from-green-500 to-green-600 text-white font-bold text-lg shadow-md transition duration-300 ease-in-out hover:from-green-600 hover:to-green-700 hover:shadow-lg active:scale-95"
                        >
                            Next Pokémon
                        </button>
                    </div>
                     <!-- Feedback message area (will primarily show only microphone access errors) -->
                    <p class="text-xl md:text-2xl font-semibold mt-6 ${listening ? 'text-blue-600' : 'text-gray-700'}">
                        ${feedbackMessage}
                    </p>
                </div>
            `;
            // Add event listeners after rendering the HTML
            document.getElementById('phoneme-filter')?.addEventListener('change', handlePhonemeFilterChange);
            document.getElementById('open-pronunciation-button')?.addEventListener('click', openPronunciationLink);
            document.getElementById('say-name-button')?.addEventListener('click', toggleRecordingAndListening);
            document.getElementById('reveal-name-button')?.addEventListener('click', async () => {
                showName = true;
                if (currentPokemon && !currentPokemonPhonetic) {
                    feedbackMessage = "Getting pronunciation...";
                    renderApp();
                    currentPokemonPhonetic = await getPhoneticPronunciation(currentPokemon.name);
                    feedbackMessage = "";
                }
                renderApp();
            });
            document.getElementById('next-pokemon-button')?.addEventListener('click', nextPokemon);
            document.getElementById('pokemon-image')?.addEventListener('error', handleImageError);
            // Add event listener for Play Recording button
            document.getElementById('play-recording-button')?.addEventListener('click', playRecording);
        };

        // Initial render when the script loads
        window.onload = () => {
            nextPokemon(); // Set up the first Pokémon and render
        };
    </script>
</body>
</html>
